# 1. SQL injection
## Introduzione
Durante la fase di information gathering, è stata individuata la possibilità per l'utente di inviare input arbitrari tramite la pagina di `login`. Gli input utente vengono trasmessi al server backend.

L'analisi del comportamento del backend ha rivelato che il server, al momento del login, costruisce dinamicamente una query SQL tramite concatenazione diretta dei parametri `email` e `password` forniti dall'utente. Questo comportamento introduce una potenziale vulnerabilità di SQL Injection. In questo caso, l'assenza di `prepared statements` o `escaped input` rende la query suscettibile a manipolazione da parte di un attaccante.

Sfruttando la vulnerabilità e l'assenza di controlli, un attaccante può costruire un payload malevolo per bypassare la verifica della password ed effettuare il login su un account esistente (tipicamente l'amministratore), conoscendone solo l'`indirizzo email`.

## Riproducibilità
1. Andare nella pagina di login del sito.
2. Nel campo `email` usare una delle email trovate tramite le review dei prodotto durante l'information gathering. Un email di esempio è: `admin@juice-sh.op`.
3. Nel campo email quindi scrivere l'email di admin oppure un email di un utente a scelta seguito da 2 trattini:
```sql
admin@juice-sh.op' --
```
4. Questo codice esegue una query SQL concatenata che permette di ignorare tutto il codice SQL che c'è dopo `--`:
```sql
SELECT * FROM users WHERE email = 'admin@juice-sh.op' -- AND PASSWORD = '' AND deletedAt IS NULL
```
Tutto il codice dopo `--` quindi `AND PASSWORD ...` viene ignorato. Controlla solo se l'email è valido.

5. Il campo password può essere riempito con una qualsiasi password. 
5. Dopo aver eseguito il login, il server restituisce l'accesso all'account da admin.
6. Si può ripetere tutte queste operazioni per tutti gli altri utenti registrati.

## Prova dell'attacco
![SQL injection login](../immagini/exploitation/sql_injection_login_request.png)

![SQL injection success](../immagini/exploitation/sql_injection_login_success.png)