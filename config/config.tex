\usepackage{listings}
\usepackage{float}

% Impostazioni per listings
\lstset{
    basicstyle=\ttfamily\small,
    breaklines=true,
    breakatwhitespace=true,
    frame=single,
    frameround=tttt,
    backgroundcolor=\color{gray!10},
    xleftmargin=2em,
    framexleftmargin=1.5em,
    showspaces=false,
    showstringspaces=false
}

% Forza le immagini a rimanere dove sono dichiarate per evitare che si spostino
\usepackage{float}
\floatplacement{figure}{H}
